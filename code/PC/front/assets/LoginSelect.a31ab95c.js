var M=(e,i,r)=>new Promise((B,s)=>{var C=l=>{try{u(r.next(l))}catch(d){s(d)}},m=l=>{try{u(r.throw(l))}catch(d){s(d)}},u=l=>l.done?B(l.value):Promise.resolve(l.value).then(C,m);u((r=r.apply(e,i)).next())});import{j as x,A as ee,cM as ae,C as p,a8 as te,bH as ue,m as se,K as o,Z as ne,u as oe,q as re,r as g,s as _,Q as I,w as t,v as F,y as b,bx as T,B as L,t as w,bc as z,z as N,ax as U,R as q,x as H,dm as le,dn as ie,aW as D}from"./index.d13d32e3.js";import{B as de}from"./index.1c9272fa.js";import"./BasicModal.d291574e.js";import"./useWindowSizeFn.67dc54bf.js";const fe=x({name:"loginSelect",components:{Avatar:ee,BasicModal:de},emits:["success","register"],setup(e,{emit:i}){const r=ae(),{notification:B}=oe(),s=p(!1),C=p([]),m=p(""),u=p(!1),l=p([]),d=p(""),h=p(!1),y=p(""),A=p(),f=te({orgCode:void 0,tenantId:null}),n={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},[V,{closeModal:$}]=ue(),P=se(()=>{if(o(u)&&o(s))return"\u8BF7\u9009\u62E9\u79DF\u6237\u548C\u90E8\u95E8";if(o(u)&&!o(s))return"\u8BF7\u9009\u62E9\u90E8\u95E8";if(!o(u)&&o(s))return"\u8BF7\u9009\u62E9\u79DF\u6237"}),j=p({tenantId:[{required:o(s),type:"number",message:"\u8BF7\u9009\u62E9\u79DF\u6237",trigger:"change"}],orgCode:[{required:o(u),message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:"change"}]}),K={labelCol:{span:4},wrapperCol:{span:18}};function Q(a){var E,v;if(((E=a.userInfo)==null?void 0:E.orgCode)&&((v=a.userInfo)==null?void 0:v.orgCode)!==""){u.value=!1;return}let c=a.multi_depart;c==0?(B.warn({message:"\u63D0\u793A",description:"\u60A8\u5C1A\u672A\u5F52\u5C5E\u90E8\u95E8,\u8BF7\u786E\u8BA4\u8D26\u53F7\u4FE1\u606F",duration:3}),u.value=!1):c==2?(u.value=!0,l.value=a.departs):u.value=!1}function W(a){var E,v;if(((E=a.userInfo)==null?void 0:E.loginTenantId)&&((v=a.userInfo)==null?void 0:v.loginTenantId)!==0){s.value=!1;return}let c=a.tenantList;Array.isArray(c)&&(c.length===0?(s.value=!1,r.setTenant(f.tenantId)):c.length===1?(f.tenantId=c[0].id,s.value=!1,r.setTenant(f.tenantId)):(s.value=!0,C.value=c))}function Z(){if(o(s)&&!f.tenantId)return m.value="error",!1;if(o(u)&&!f.orgCode)return d.value="error",!1;A.value.validate().then(()=>{G().then(()=>{r.setTenant(f.tenantId),i("success")}).catch(a=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",a)}).finally(()=>{O()})}).catch(a=>{console.log("\u8868\u5355\u6821\u9A8C\u672A\u901A\u8FC7error",a)})}function G(){return new Promise((a,c)=>{if(!o(u)&&!o(s))a();else{let E={orgCode:f.orgCode,loginTenantId:f.tenantId,username:o(y)};ne.put({url:"/sys/selectDepart",params:E}).then(v=>{v.userInfo?(r.setUserInfo(v.userInfo),a()):(J(v),r.logout(),c())})}})}function J(a){B.error({message:"\u767B\u5F55\u5931\u8D25",description:((a.response||{}).data||{}).message||a.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function O(){$(),k()}function X(a){return M(this,null,function*(){a&&(y.value=r.username,yield k(),yield Q(a),yield W(a),!o(u)&&!o(s)?i("success",r.getUserInfo):h.value=!0),a.isLogin=!1,r.setLoginInfo(a)})}function k(){C.value=[],m.value="",l.value=[],d.value=""}function Y(a){m.value=""}function R(a){d.value=""}return{registerModal:V,visible:h,tenantList:C,isMultiTenant:s,validate_status:m,isMultiDepart:u,departList:l,validate_status1:d,formState:f,rules:j,layout:K,formRef:A,currTitle:P,config:n,handleTenantChange:Y,handleDepartChange:R,show:X,handleSubmit:Z}}});const S=e=>(le("data-v-6e0f5500"),e=e(),ie(),e),ce=S(()=>D("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),pe=S(()=>D("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),me=S(()=>D("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),ve=S(()=>D("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1));function ge(e,i,r,B,s,C){const m=g("a-avatar"),u=g("a-tooltip"),l=g("a-select-option"),d=g("a-select"),h=g("a-form-item"),y=g("a-form"),A=g("a-button"),f=g("BasicModal");return _(),I(f,H(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":i[2]||(i[2]=n=>e.visible=n)}),{footer:t(()=>[F(A,{onClick:e.handleSubmit,type:"primary"},{default:t(()=>[b("\u786E\u8BA4")]),_:1},8,["onClick"])]),default:t(()=>[F(y,H({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:t(()=>[e.isMultiTenant?(_(),I(h,{key:0,name:"tenantId","validate-status":e.validate_status},T({label:t(()=>[F(u,{placement:"topLeft"},{title:t(()=>[ce]),default:t(()=>[F(m,{style:{"background-color":"#87d068"},size:30},{default:t(()=>[b(" \u79DF\u6237 ")]),_:1})]),_:1})]),default:t(()=>[F(d,{value:e.formState.tenantId,"onUpdate:value":i[0]||(i[0]=n=>e.formState.tenantId=n),onChange:e.handleTenantChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",class:L({"valid-error":e.validate_status=="error"})},{default:t(()=>[(_(!0),w(U,null,z(e.tenantList,n=>(_(),I(l,{key:n.id,value:n.id},{default:t(()=>[b(N(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status=="error"?{name:"extra",fn:t(()=>[pe]),key:"0"}:void 0]),1032,["validate-status"])):q("",!0),e.isMultiDepart?(_(),I(h,{key:1,"validate-status":e.validate_status1,colon:!1},T({label:t(()=>[F(u,{placement:"topLeft"},{title:t(()=>[me]),default:t(()=>[F(m,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:t(()=>[b(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:t(()=>[F(d,{value:e.formState.orgCode,"onUpdate:value":i[1]||(i[1]=n=>e.formState.orgCode=n),onChange:e.handleDepartChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:L({"valid-error":e.validate_status1=="error"})},{default:t(()=>[(_(!0),w(U,null,z(e.departList,n=>(_(),I(l,{key:n.orgCode,value:n.orgCode},{default:t(()=>[b(N(n.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status1=="error"?{name:"extra",fn:t(()=>[ve]),key:"0"}:void 0]),1032,["validate-status"])):q("",!0)]),_:1},16,["model","rules"])]),_:1},16,["onRegister","title","visible"])}const he=re(fe,[["render",ge],["__scopeId","data-v-6e0f5500"]]);export{he as default};
