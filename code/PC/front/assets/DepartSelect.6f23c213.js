var E=(m,k,c)=>new Promise((d,h)=>{var x=l=>{try{B(c.next(l))}catch(s){h(s)}},T=l=>{try{B(c.throw(l))}catch(s){h(s)}},B=l=>l.done?d(l.value):Promise.resolve(l.value).then(x,T);B((c=c.apply(m,k)).next())});import{B as ue}from"./index.1c9272fa.js";import{g as le,h as se}from"./depart.api.0bd5897e.js";import{o as oe}from"./tenant.api.27aec417.js";import{j as ne,cM as re,C as r,E as ie,r as v,s as _,Q as b,w as a,v as i,y as C,B as H,t as P,bc as $,z as j,ax as K,R as Q,x as W,K as e,dm as ce,dn as de,aW as G,u as fe,q as pe}from"./index.d13d32e3.js";import"./BasicModal.d291574e.js";import"./useWindowSizeFn.67dc54bf.js";const J=m=>(ce("data-v-11b7dc10"),m=m(),de(),m),ve=J(()=>G("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5C5E\u79DF\u6237",-1)),me=J(()=>G("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5728\u90E8\u95E8",-1)),_e=ne({__name:"DepartSelect",props:{title:{type:String,default:"\u90E8\u95E8\u9009\u62E9"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(m,{expose:k}){const c=m,d=re(),{createMessage:h,notification:x}=fe(),T={labelCol:{span:4},wrapperCol:{span:18}},B={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},l=r(""),s=r(!1),D=r(""),f=r(),N=r([]),w=r(""),p=r(!1),y=r(""),g=r(""),A=r([]),S=r(""),I=r(!1);function O(){return E(this,null,function*(){yield U(),yield X(),e(s)&&e(p)?l.value="\u5207\u6362\u79DF\u6237\u548C\u90E8\u95E8":e(s)?l.value=e(D)&&e(D).length>0?`\u79DF\u6237\u5207\u6362\uFF08\u5F53\u524D\u79DF\u6237 :${e(D)}\uFF09`:c.title:e(p)&&(l.value=e(y)&&e(y).length>0?`\u90E8\u95E8\u5207\u6362\uFF08\u5F53\u524D\u90E8\u95E8 :${e(y)}\uFF09`:c.title),(e(s)||e(p))&&(I.value=!0)})}function U(){return E(this,null,function*(){const t=yield le();if(!t.list||t.list.length==0)return;let u=t.list.filter(n=>n.orgCode==t.orgCode);A.value=t.list,g.value=u&&u.length>0?t.orgCode:"",y.value=u&&u.length>0?u[0].departName:"",p.value=!0})}function X(){return E(this,null,function*(){const t=yield oe();if(!t.list||t.list.length==0)return;let u=d.getTenant,n=t.list.filter(F=>F.id==u);D.value=n&&n.length>0?n[0].name:"",N.value=t.list,f.value=u,s.value=!0})}function Y(){return E(this,null,function*(){if(e(s)&&e(f)==null)return w.value="error",!1;if(e(p)&&!e(g))return S.value="error",!1;Z().then(()=>{e(s)&&d.setTenant(e(f)),h.success("\u5207\u6362\u6210\u529F"),window.location.reload()}).catch(t=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",t)}).finally(()=>{e(s)&&d.setTenant(e(f)),L()})})}function Z(){return new Promise((t,u)=>E(this,null,function*(){if(!e(p))t();else{const n=yield se({username:d.getUserInfo.username,orgCode:e(g),loginTenantId:e(f)});if(n.userInfo){const F=n.userInfo;d.setUserInfo(F),t()}else ee(n),d.logout(),u()}}))}function ee(t){x.error({message:"\u767B\u5F55\u5931\u8D25",description:((t.response||{}).data||{}).message||t.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function L(){te()}function te(){l.value="",s.value=!1,D.value="",f.value="",N.value=[],w.value="",p.value=!1,y.value="",g.value="",A.value=[],S.value="",I.value=!1}return ie(()=>c.username,t=>{t&&U()}),k({show:O}),(t,u)=>{const n=v("a-avatar"),F=v("a-tooltip"),M=v("Icon"),z=v("a-select-option"),V=v("a-select"),R=v("a-form-item"),ae=v("a-form"),q=v("a-button");return _(),b(e(ue),W(B,{title:l.value,visible:I.value,"onUpdate:visible":u[2]||(u[2]=o=>I.value=o),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(q,{onClick:L},{default:a(()=>[C("\u5173\u95ED")]),_:1}),i(q,{onClick:Y,type:"primary"},{default:a(()=>[C("\u786E\u8BA4")]),_:1})]),default:a(()=>[i(ae,W({ref:"formRef"},T,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[s.value?(_(),b(R,{key:0,"validate-status":w.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(n,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[C(" \u79DF\u6237 ")]),_:1})]),_:1})]),default:a(()=>[i(V,{value:f.value,"onUpdate:value":u[0]||(u[0]=o=>f.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:H({"valid-error":w.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),P(K,null,$(N.value,o=>(_(),b(z,{key:o.id,value:o.id},{default:a(()=>[C(j(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):Q("",!0),p.value?(_(),b(R,{key:1,"validate-status":S.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(n,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[C(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:a(()=>[i(V,{value:g.value,"onUpdate:value":u[1]||(u[1]=o=>g.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:H({"valid-error":S.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),P(K,null,$(A.value,o=>(_(),b(z,{key:o.orgCode,value:o.orgCode},{default:a(()=>[C(j(o.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):Q("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const be=pe(_e,[["__scopeId","data-v-11b7dc10"]]);export{be as default};
