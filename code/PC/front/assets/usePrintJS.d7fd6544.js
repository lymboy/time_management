import{$ as f}from"./print.0d636f73.js";import{G as y}from"./index.d13d32e3.js";class g{constructor(e){this.standards={strict:"strict",loose:"loose",html5:"html5"},this.counter=0,this.settings={standard:this.standards.html5,extraHead:"",extraCss:"",popTitle:"",endCallback:null,el:""},Object.assign(this.settings,e),this.init()}init(){this.counter++,this.settings.id=`printArea_${this.counter}`;let e=document.getElementById(this.settings.id);e&&e.parentNode.removeChild(e);let t=this.getPrintWindow();this.write(t.doc),this.settings.endCallback()}print(e){let t=e;console.log("---\u8C03\u7528\u6253\u5370 focus-----"),t.focus(),t.print(),console.log("---\u8C03\u7528\u6253\u5370 print-----")}write(e,t){e.open(),e.write(`${this.docType()}<html>${this.getHead()}${this.getBody()}</html>`),e.close()}docType(){if(this.settings.standard===this.standards.html5)return"<!DOCTYPE html>";var e=this.settings.standard===this.standards.loose?" Transitional":"",t=this.settings.standard===this.standards.loose?"loose":"strict";return`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01${e}//EN" "http://www.w3.org/TR/html4/${t}.dtd">`}getHead(){let e="",t="",l="";this.settings.extraHead&&this.settings.extraHead.replace(/([^,]+)/g,function(s){e+=s}),[].forEach.call(document.querySelectorAll("link"),function(s,o){s.href.indexOf(".css")>=0&&(t+='<link type="text/css" rel="stylesheet" href="'+s.href+'" >')});for(let s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].cssRules||document.styleSheets[s].rules){let o=document.styleSheets[s].cssRules||document.styleSheets[s].rules;for(let c=0;c<o.length;c++)try{l+=o[c].cssText}catch(u){}}return this.settings.extraCss&&this.settings.extraCss.replace(/([^,\s]+)/g,function(s){t+=`<link type="text/css" rel="stylesheet" href="${s}">`}),`<head><title>${this.settings.popTitle}</title>${e}${t}<style type="text/css">${l}</style></head>`}getBody(){let t=this.getFormData(document.querySelector(this.settings.el)).outerHTML;return console.log("htm",t),"<body>"+t+"</body>"}getFormData(e){let t=this,l=e.cloneNode(!0),s=l.querySelectorAll("*");[].forEach.call(s,function(r){let i=r.getAttribute("ignore-print");i=i==null?r.getAttribute("ignoreprint"):i,i!=null&&i.toString()==="true"&&(r.outerHTML="")});let o=l.querySelectorAll("input,select,textarea");[].forEach.call(o,function(r,i){let a=r.getAttribute("type"),h=o[i];a==null&&(a=r.tagName==="SELECT"?"select":r.tagName==="TEXTAREA"?"textarea":""),a==="radio"||a==="checkbox"?h.setAttribute("checked",r.checked):a==="select"?[].forEach.call(h.querySelectorAll("option"),function(p,b){p.selected&&p.setAttribute("selected",!0)}):a==="textarea"?h.innerHTML=r.value:(h.value=r.value,h.setAttribute("value",r.value))});var c=e.querySelectorAll("canvas"),u=l.querySelectorAll("canvas");return[].forEach.call(u,function(r,i){t.isECharts(r)&&(r.parentElement.style.width&&(r.parentElement.style.width="100%"),r.parentElement.parentElement.style.width&&(r.parentElement.parentElement.style.width="100%"));var a=c[i].toDataURL();r.outerHTML='<img src="'+a+'" style="width:100%;"/>'}),l}isECharts(e){let t="_echarts_instance_",l=e.parentElement;return l.getAttribute(t)!=null?!0:l.parentElement.getAttribute(t)!=null}getPrintWindow(){var e=this.Iframe();return{win:e.contentWindow||e,doc:e.doc}}Iframe(){let e=this.settings.id,t;var l=this;try{t=document.createElement("iframe"),document.body.appendChild(t),t.style.border="0px",t.style.position="absolute",t.style.width="0px",t.style.height="0px",t.style.right="0px",t.style.top="0px",t.setAttribute("id",e),t.setAttribute("src",new Date().getTime()),t.doc=null,t.onload=function(){var s=t.contentWindow||t;l.print(s)},t.doc=t.contentDocument?t.contentDocument:t.contentWindow?t.contentWindow.document:t.document}catch(s){throw new Error(s+". iframes may not be supported in this browser.")}if(t.doc==null)throw new Error("Cannot find document.");return t}}function T(n){if((n==null?void 0:n.type)==="html")m(n.printable);else return f(n)}function m(n){n?w(n):window.print()}let d=!0;function w(n){typeof n=="string"&&!n.startsWith("#")&&(n="#"+n),y(()=>{d&&(d=!1,new g({el:n,endCallback(){d=!0}}))})}export{T as printJS,m as printNb};
