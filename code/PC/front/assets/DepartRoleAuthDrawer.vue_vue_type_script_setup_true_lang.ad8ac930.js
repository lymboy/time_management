var w=(h,a,l)=>new Promise((i,r)=>{var s=t=>{try{u(l.next(t))}catch(d){r(d)}},c=t=>{try{u(l.throw(t))}catch(d){r(d)}},u=t=>t.done?i(t.value):Promise.resolve(t.value).then(s,c);u((l=l.apply(h,a)).next())});import{_ as P}from"./index.61b0c164.js";import{u as z,a as A,B as O}from"./index.57c0270a.js";import{j as Q,C as o,r as f,s as m,t as W,v as y,w as p,y as G,aW as x,Q as E,K as D,z as H,R as J,ax as M}from"./index.d13d32e3.js";import{_ as U}from"./DepartRoleDataRuleDrawer.vue_vue_type_script_setup_true_lang.c5dcde5e.js";import{a as X,b as Y,c as Z}from"./depart.user.api.fdf3773d.js";const le=Q({__name:"DepartRoleAuthDrawer",emits:["register"],setup(h){const a=o(!1),l=o(""),i=o(""),r=o([]),s=o([]),c=o([]),u=o([]),t=o([]),d=o([]),I=o(!0),[C,{closeDrawer:F}]=z(e=>{i.value=e.record.id,l.value=e.record.departId,K()}),[B,b]=A();function K(){return w(this,null,function*(){try{a.value=!0;const{ids:e,treeList:n}=yield X({departId:l.value});e.length>0?(d.value=e,u.value=e,r.value=n,s.value=yield Y({roleId:i.value}),c.value=[s.value]):_()}finally{a.value=!1}})}function _(){r.value=[],u.value=[],s.value=[],c.value=[],a.value=!1}function S(e){I.value?s.value=e.checked:s.value=e}function T(e){u.value=e}function N(e,{selectedNodes:n}){var v;if((v=n[0])!=null&&v.ruleFlag){let g=e[0];b.openDrawer(!0,{roleId:i,departId:l,functionId:g})}t.value=[]}function V(){_(),F()}function $(){_()}function R(e){return w(this,null,function*(){try{a.value=!0;let n={roleId:i.value,permissionIds:s.value.join(","),lastpermissionIds:c.value.join(",")};yield Z(n),e&&V()}finally{a.value=!1,e||K()}})}return(e,n)=>{const v=f("Icon"),g=f("a-empty"),j=f("a-spin"),q=f("a-button");return m(),W(M,null,[y(D(O),{title:"\u90E8\u95E8\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:650,loading:a.value,showFooter:"",okText:"\u4FDD\u5B58\u5E76\u5173\u95ED",onOk:n[1]||(n[1]=k=>R(!0)),onClose:$,onRegister:D(C)},{centerFooter:p(()=>[y(q,{type:"primary",loading:a.value,ghost:"",onClick:n[0]||(n[0]=k=>R(!1))},{default:p(()=>[G("\u4EC5\u4FDD\u5B58")]),_:1},8,["loading"])]),default:p(()=>[x("div",null,[y(j,{spinning:a.value},{default:p(()=>[r.value.length>0?(m(),E(D(P),{key:0,title:"\u6240\u62E5\u6709\u7684\u90E8\u95E8\u6743\u9650",toolbar:"",checkable:"",treeData:r.value,checkedKeys:s.value,selectedKeys:t.value,expandedKeys:u.value,checkStrictly:I.value,clickRowToExpand:!1,onCheck:S,onExpand:T,onSelect:N},{title:p(({slotTitle:k,ruleFlag:L})=>[x("span",null,H(k),1),L?(m(),E(v,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):J("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(m(),E(g,{key:1,description:"\u65E0\u53EF\u914D\u7F6E\u90E8\u95E8\u6743\u9650"}))]),_:1},8,["spinning"])])]),_:1},8,["loading","onRegister"]),y(U,{onRegister:D(B)},null,8,["onRegister"])],64)}}});export{le as _};
