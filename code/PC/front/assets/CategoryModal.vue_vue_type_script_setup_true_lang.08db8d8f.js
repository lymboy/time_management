var P=Object.defineProperty;var C=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var w=(e,s,t)=>s in e?P(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,h=(e,s)=>{for(var t in s||(s={}))E.call(s,t)&&w(e,t,s[t]);if(C)for(var t of C(s))I.call(s,t)&&w(e,t,s[t]);return e};var B=(e,s,t)=>new Promise((i,l)=>{var m=n=>{try{d(t.next(n))}catch(p){l(p)}},g=n=>{try{d(t.throw(n))}catch(p){l(p)}},d=n=>n.done?i(n.value):Promise.resolve(n.value).then(m,g);d((t=t.apply(e,s)).next())});import{B as T}from"./index.1c9272fa.js";import{B as _}from"./BasicForm.e6ef05c4.js";import"./componentMap.6f8f51f6.js";import{u as k}from"./useForm.1a92e1aa.js";import"./JAddInput.ec01e271.js";import{Z as u,a2 as L,j as U,C as x,bH as M,m as R,K as a,s as S,Q as A,w as O,v as H,x as j}from"./index.d13d32e3.js";const J=[{title:"\u5206\u7C7B\u540D\u79F0",dataIndex:"name",width:350,align:"left"},{title:"\u5206\u7C7B\u7F16\u7801",dataIndex:"code"}],W=[{label:"\u540D\u79F0",field:"name",component:"Input",colProps:{span:6}},{label:"\u7F16\u7801",field:"code",component:"Input",colProps:{span:6}}],K=[{label:"",field:"id",component:"Input",show:!1},{label:"\u7236\u7EA7\u8282\u70B9",field:"pid",component:"TreeSelect",componentProps:{replaceFields:{value:"key"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:()=>document.body},show:({values:e})=>e.pid!=="0",dynamicDisabled:({values:e})=>!!e.id},{label:"\u5206\u7C7B\u540D\u79F0",field:"name",required:!0,component:"Input"}],Y="/sys/category/exportXls",ee="/sys/category/importExcel",te=e=>u.get({url:"/sys/category/rootList",params:e}),se=(e,s)=>u.delete({url:"/sys/category/delete",params:e},{joinParamsToUrl:!0}).then(()=>{s()}),oe=(e,s)=>{L.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>u.delete({url:"/sys/category/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{s()})})},V=(e,s)=>{let t=s?"/sys/category/edit":"/sys/category/add";return u.post({url:t,params:e})},q=e=>u.get({url:"/sys/category/loadTreeRoot",params:e}),ae=e=>u.get({url:"/sys/category/childList",params:e}),ne=e=>u.get({url:"/sys/category/getChildListBatch",params:e},{isTransformResponse:!1}),re=U({__name:"CategoryModal",emits:["register","success"],setup(e,{emit:s}){const t=x(!0),i=x([]),l=x([]),[m,{resetFields:g,setFieldsValue:d,validate:n,updateSchema:p}]=k({schemas:K,showActionButtonGroup:!1,labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[F,{setModalProps:f,closeModal:v}]=M(o=>B(this,null,function*(){yield g(),i.value=[],f({confirmLoading:!1,minHeight:80}),t.value=!!(o!=null&&o.isUpdate),o!=null&&o.record&&(yield d(h({},o.record))),l.value=yield q({async:!1,pcode:""}),p({field:"pid",componentProps:{treeData:l}})})),b=R(()=>a(t)?"\u7F16\u8F91\u5B57\u5178":"\u65B0\u589E\u5B57\u5178");function y(o,r){if(o&&r&&r.length>0)for(let c=0;c<r.length;c++)r[c].key==o&&a(i).indexOf(o)<0?(i.value.push(r[c].key),y(r[c].parentId,a(l))):y(o,r[c].children)}function D(){return B(this,null,function*(){try{let o=yield n();f({confirmLoading:!0}),yield V(o,t.value),v(),yield y(o.pid,a(l)),s("success",{isUpdate:a(t),values:h({},o),expandedArr:a(i).reverse()})}finally{f({confirmLoading:!1})}})}return(o,r)=>(S(),A(a(T),j(o.$attrs,{onRegister:a(F),destroyOnClose:"",title:a(b),onOk:D}),{default:O(()=>[H(a(_),{onRegister:a(m)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{re as _,ee as a,oe as b,J as c,ne as d,ae as e,se as f,Y as g,te as l,W as s};
