var se=Object.defineProperty;var O=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var j=(s,l,u)=>l in s?se(s,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[l]=u,z=(s,l)=>{for(var u in l||(l={}))oe.call(l,u)&&j(s,u,l[u]);if(O)for(var u of O(l))ie.call(l,u)&&j(s,u,l[u]);return s};import{j as K,m as B,s as C,t as _,N as $,O as R,aW as v,v as h,K as r,I as F,ax as Q,u as W,aN as d,l as le,bv as re,a8 as ue,n as ce,C as N,E as q,r as S,w as G,x as de,B as fe,cI as me,z as J,R as H,Q as pe,G as ge,a as I}from"./index.d13d32e3.js";import{c as ve}from"./api.ae3b9cbd.js";import{c as he}from"./functional.fdb540f5.js";var P=(s=>(s.all="all",s.image="image",s.file="file",s))(P||{});const be={class:"upload-download-handler"},we={class:"upload-mover-handler"},Ce=K({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(s){const l=s,{createMessage:u}=W(),o=B(()=>r(l.fileList));function y(){let t=A();if(t===-1){u.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+t);return}if(t===0){p(t,r(o).length-1);return}p(t,t-1)}function E(){let t=A();if(t===-1){u.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+t);return}if(t==r(o).length-1){p(t,0);return}p(t,t+1)}function p(t,f){if(t!==f){let c=[...r(o)],g=c[t];c[t]=c[f],c[f]=g,l.emitValue(c.map(m=>m.url).join(","))}}function A(){var f,c;const t=(c=(f=l.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:c.src;if(t){const g=r(o);for(let m=0;m<g.length;m++){let x=g[m].url;const b=t.replace(window.location.origin,"");if(x===b||encodeURI(x)===b)return m}}return-1}function U(){var f,c;const t=(c=(f=l.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:c.src;window.open(t)}return(t,f)=>(C(),_(Q,null,[$(v("div",be,[v("a",{class:"download",title:"\u4E0B\u8F7D",onClick:U},[h(r(F),{icon:"ant-design:download"})])],512),[[R,s.download]]),$(v("div",we,[v("a",{title:"\u5411\u524D\u79FB\u52A8",onClick:y},[h(r(F),{icon:"ant-design:arrow-left"})]),v("a",{title:"\u5411\u540E\u79FB\u52A8",onClick:E},[h(r(F),{icon:"ant-design:arrow-right"})])],512),[[R,s.mover&&r(o).length>1]])],64))}}),Fe={key:0},ye={class:"ant-upload-text"},Ee=K({__name:"JUpload",props:{value:d.oneOfType([d.string,d.array]),text:d.string.def("\u4E0A\u4F20"),fileType:d.string.def(P.all),bizPath:d.string.def("temp"),returnUrl:d.bool.def(!0),maxCount:d.number.def(0),buttonVisible:d.bool.def(!0),multiple:d.bool.def(!0),mover:d.bool.def(!0),download:d.bool.def(!0),removeConfirm:d.bool.def(!1),beforeUpload:d.func,disabled:d.bool.def(!1)},emits:["change","update:value"],setup(s,{expose:l,emit:u}){const o=s,{createMessage:y,createConfirm:E}=W(),{prefixCls:p}=le("j-upload"),A=re(),U=ue({"X-Access-Token":ce()}),t=N([]),f=N(!0),c=N(),g=B(()=>o.maxCount>0&&t.value.length>=o.maxCount),m=B(()=>o.fileType===P.image),x=B(()=>{const e=Object.assign({},o,A);return e.name="file",e.listType=m.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":o.disabled}],e.data=z({biz:o.bizPath},e.data),e.beforeUpload||(e.beforeUpload=Y),m.value&&!e.accept&&(e.accept="image/*"),e});q(()=>o.value,e=>{Array.isArray(e)?o.returnUrl?V(e.join(",")):X(e):V(e)},{immediate:!0}),q(t,()=>ge(()=>T()),{immediate:!0});const b="ant-upload-list-item";function T(){if(!m.value)return;const e=c.value?c.value.getElementsByClassName(b):null;if(!(!e||e.length===0))for(const a of e)a.getAttribute("data-has-actions")==="true"||a.addEventListener("mouseover",D)}function D(e){const n=(()=>{for(const k of e.path){if(k.classList.contains(b))return k;if(k.classList.contains(`${p}-container`))return null}return null})();if(!n)return;const i=n.getElementsByClassName("ant-upload-list-item-actions");if(!i||i.length===0)return;const w=document.createElement("div");w.className="upload-actions-container",me(Ce,{element:n,fileList:t,mover:o.mover,download:o.download,emitValue:L}).mount(w),i[0].appendChild(w),n.setAttribute("data-has-actions","true"),n.removeEventListener("mouseover",D)}function V(e){if(!e||e.length==0){t.value=[];return}let a=[];for(const n of e.split(",")){let i=I(n);a.push({uid:M(),name:ae(n),status:"done",url:i,response:{status:"history",message:n}})}t.value=a}function X(e){if(!e||e.length==0){t.value=[];return}let a=[];for(const n of e){let i=I(n.filePath);a.push({uid:M(),name:n.fileName,url:i,status:"done",response:{status:"history",message:n.filePath}})}t.value=a}function Y(e){return f.value=!0,m.value&&e.type.indexOf("image")<0?(y.warning("\u8BF7\u4E0A\u4F20\u56FE\u7247"),f.value=!1,!1):typeof o.beforeUpload=="function"?o.beforeUpload(e):!0}function Z(){return o.removeConfirm?new Promise(e=>{E({title:"\u5220\u9664",content:`\u786E\u5B9A\u8981\u5220\u9664\u8FD9${m.value?"\u5F20\u56FE\u7247":"\u4E2A\u6587\u4EF6"}\u5417\uFF1F`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}):!0}function ee(e){!e.file.status&&f.value===!1&&e.fileList.pop();let a=e.fileList;if(o.maxCount>0&&a.length>=o.maxCount)if(o.maxCount-a.length>=0)a=a.slice(-o.maxCount);else return;if(e.file.status==="done"?e.file.response.success&&(a=a.map(n=>{if(n.response){let i=n.response.message;n.url=I(i)}return n})):e.file.status==="error"&&y.error(`${e.file.name} \u4E0A\u4F20\u5931\u8D25.`),t.value=a,e.file.status==="done"||e.file.status==="removed")if(o.returnUrl)te();else{let n=[];for(const i of a)if(i.status==="done"){let w={fileName:i.name,filePath:i.response.message,fileSize:i.size};n.push(w)}else return;L(n)}}function te(){let e=t.value,a="";(!e||e.length==0)&&(a="");let n=[];for(const i of e)if(i.status==="done")n.push(i.response.message);else return;n.length>0&&(a=n.join(",")),L(a)}function ne(e){m.value?he({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function L(e){u("change",e),u("update:value",e)}function M(){return"-"+parseInt(Math.random()*1e4+1,10)}function ae(e){if(e.lastIndexOf("\\")>=0){let a=new RegExp("\\\\","g");e=e.replace(a,"/")}return e.substring(e.lastIndexOf("/")+1)}return l({addActionsListener:T}),(e,a)=>{const n=S("a-button"),i=S("a-upload");return C(),_("div",{ref_key:"containerRef",ref:c,class:fe(`${r(p)}-container`)},[h(i,de({headers:U,multiple:s.multiple,action:r(ve),fileList:t.value,disabled:s.disabled},r(x),{onRemove:Z,onChange:ee,onPreview:ne}),{default:G(()=>[r(m)?(C(),_(Q,{key:0},[r(g)?H("",!0):(C(),_("div",Fe,[h(r(F),{icon:"ant-design:plus-outlined"}),v("div",ye,J(s.text),1)]))],64)):s.buttonVisible?(C(),pe(n,{key:1,disabled:r(g)||s.disabled},{default:G(()=>[h(r(F),{icon:"ant-design:upload-outlined"}),v("span",null,J(s.text),1)]),_:1},8,["disabled"])):H("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{P as U,Ee as _};
