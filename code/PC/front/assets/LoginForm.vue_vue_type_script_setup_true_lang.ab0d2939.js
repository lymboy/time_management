var B=(D,l,u)=>new Promise((i,v)=>{var F=d=>{try{f(u.next(d))}catch(y){v(y)}},o=d=>{try{f(u.throw(d))}catch(y){v(y)}},f=d=>d.done?i(d.value):Promise.resolve(d.value).then(F,o);f((u=u.apply(D,l)).next())});import{j as P,a7 as K,aB as E,l as V,cM as W,ew as H,ex as Q,C as S,a8 as A,m as X,X as Y,s as b,t as R,N as q,O as N,K as e,v as s,w as a,aF as J,y as g,z as p,cH as C,eD as x,b7 as Z,aW as k,B as ee,bY as se,ax as te,cv as ae,cG as oe,o as ne,ac as le,eI as ie,u as re,eA as ue}from"./index.d13d32e3.js";import{c as de}from"./checkcode.26910ff2.js";import{_ as ce}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang.03e93f14.js";import me from"./ThirdModal.9c17ef40.js";import{c as ge,D as pe}from"./IconFont.27254991.js";import{G as fe}from"./GithubFilled.721b4e20.js";import{W as ye}from"./WechatFilled.4e4a768e.js";const Ce=["src"],Ie=P({__name:"LoginForm",setup(D){const l=ae,u=oe,i=K.Item,v=E.Password,F=ge({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:o}=ne(),{notification:f,createErrorModal:d}=re(),{prefixCls:y}=V("login"),U=W(),{setLoginState:w,getLoginState:G}=H(),{getFormRules:O}=Q(),$=S(),M=S(),I=S(!1),T=S(!1),c=A({account:"jeecg",password:"123456",inputCode:""}),m=A({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:j}=ue($),L=X(()=>e(G)===x.LOGIN);function z(){return B(this,null,function*(){const r=yield j();if(!!r)try{I.value=!0;const{userInfo:t}=yield U.login(le({password:r.password,username:r.account,captcha:r.inputCode,checkKey:m.checkKey,mode:"none"}));t&&f.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${t.realname}`,duration:3})}catch(t){f.error({message:o("sys.api.errorTip"),description:t.message||o("sys.api.networkExceptionMsg"),duration:3}),I.value=!1,_()}})}function _(){c.inputCode="",m.checkKey=1629428467008,ie(m.checkKey).then(r=>{m.randCodeImage=r,m.requestCodeSuccess=!0})}function h(r){M.value.onThirdLogin(r)}return Y(()=>{_()}),(r,t)=>(b(),R(te,null,[q(s(ce,{class:"enter-x"},null,512),[[N,e(L)]]),q(s(e(K),{class:"p-4 enter-x",model:c,rules:e(O),ref_key:"formRef",ref:$,onKeypress:se(z,["enter"])},{default:a(()=>[s(e(i),{name:"account",class:"enter-x"},{default:a(()=>[s(e(E),{size:"large",value:c.account,"onUpdate:value":t[0]||(t[0]=n=>c.account=n),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:a(()=>[s(e(v),{size:"large",visibilityToggle:"",value:c.password,"onUpdate:value":t[1]||(t[1]=n=>c.password=n),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(u),{class:"enter-x"},{default:a(()=>[s(e(l),{span:12},{default:a(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:a(()=>[s(e(E),{size:"large",value:c.inputCode,"onUpdate:value":t[2]||(t[2]=n=>c.inputCode=n),placeholder:e(o)("sys.login.inputCode"),style:{"min-width":"100px"}},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(l),{span:8},{default:a(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:a(()=>[m.requestCodeSuccess?(b(),R("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:_},null,8,Ce)):(b(),R("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:de,onClick:_}))]),_:1})]),_:1})]),_:1}),s(e(u),{class:"enter-x"},{default:a(()=>[s(e(l),{span:12},{default:a(()=>[s(e(i),null,{default:a(()=>[s(e(J),{checked:T.value,"onUpdate:checked":t[3]||(t[3]=n=>T.value=n),size:"small"},{default:a(()=>[g(p(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(l),{span:12},{default:a(()=>[s(e(i),{style:{"text-align":"right"}},{default:a(()=>[s(e(C),{type:"link",size:"small",onClick:t[4]||(t[4]=n=>e(w)(e(x).RESET_PASSWORD))},{default:a(()=>[g(p(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:a(()=>[s(e(C),{type:"primary",size:"large",block:"",onClick:z,loading:I.value},{default:a(()=>[g(p(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(u),{class:"enter-x"},{default:a(()=>[s(e(l),{md:8,xs:24},{default:a(()=>[s(e(C),{block:"",onClick:t[5]||(t[5]=n=>e(w)(e(x).MOBILE))},{default:a(()=>[g(p(e(o)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:a(()=>[s(e(C),{block:"",onClick:t[6]||(t[6]=n=>e(w)(e(x).QR_CODE))},{default:a(()=>[g(p(e(o)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:7,xs:24},{default:a(()=>[s(e(C),{block:"",onClick:t[7]||(t[7]=n=>e(w)(e(x).REGISTER))},{default:a(()=>[g(p(e(o)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(Z),{class:"enter-x"},{default:a(()=>[g(p(e(o)("sys.login.otherSignIn")),1)]),_:1}),k("div",{class:ee(["flex justify-evenly enter-x",`${e(y)}-sign-in-way`])},[k("a",{onClick:t[8]||(t[8]=n=>h("github")),title:"github"},[s(e(fe))]),k("a",{onClick:t[9]||(t[9]=n=>h("wechat_enterprise")),title:"\u4F01\u4E1A\u5FAE\u4FE1"},[s(e(F),{class:"item-icon",type:"icon-qiyeweixin3"})]),k("a",{onClick:t[10]||(t[10]=n=>h("dingtalk")),title:"\u9489\u9489"},[s(e(pe))]),k("a",{onClick:t[11]||(t[11]=n=>h("wechat_open")),title:"\u5FAE\u4FE1"},[s(e(ye))])],2)]),_:1},8,["model","rules","onKeypress"]),[[N,e(L)]]),s(me,{ref_key:"thirdModalRef",ref:M},null,512)],64))}});export{Ie as _};
