var w=(m,h,d)=>new Promise((_,i)=>{var p=u=>{try{s(d.next(u))}catch(c){i(c)}},v=u=>{try{s(d.throw(u))}catch(c){i(c)}},s=u=>u.done?_(u.value):Promise.resolve(u.value).then(p,v);s((d=d.apply(m,h)).next())});import{a as Q,u as W,B as G}from"./index.57c0270a.js";import{_ as H}from"./index.61b0c164.js";import{j as J,C as r,K as o,r as D,s as x,Q as F,w as t,y as l,v as a,bD as U,z as X,R as Y,x as Z,dm as ee,dn as te,aW as K,q as oe}from"./index.d13d32e3.js";import{_ as ae}from"./RoleDataRuleDrawer.vue_vue_type_script_setup_true_lang.9bba634f.js";import{m as le,n as A,o as se}from"./role.api.2e681792.js";import"./bem.0a70e06a.js";import"./props.1766c95e.js";import"./useContextMenu.17d08add.js";const S=m=>(ee("data-v-537e681b"),m=m(),te(),m),ue=S(()=>K("div",{class:"line"},null,-1)),ne=S(()=>K("div",{class:"line"},null,-1)),re=J({__name:"RolePermissionDrawer",emits:["register"],setup(m,{emit:h}){const d=r([]),_=r([]),i=r([]),p=r([]),v=r([]),s=r(""),u=r(null),c=r(!1),g=r([]),k=r(!0),[T,{openDrawer:b}]=Q(),[P,{setDrawerProps:E,closeDrawer:R}]=W(e=>w(this,null,function*(){yield V(),E({confirmLoading:!1,loading:!0}),s.value=e.roleId;const n=yield le();d.value=n.treeList,_.value=n.ids,g.value=n.ids;const f=yield A({roleId:o(s)});i.value=f,p.value=f,E({loading:!1})}));function N(e){i.value=e.checked?e.checked:e}function $(e){e&&e.length>0&&(v.value=e),b(!0,{functionId:o(v)[0],roleId:o(s)})}function V(){d.value=[],_.value=[],i.value=[],p.value=[],v.value=[],s.value=""}function j(){const e=o(u);if(!e)throw new Error("tree is null!");return e}function B(e){return w(this,null,function*(){let n={roleId:o(s),permissionIds:o(j().getCheckedKeys()).join(","),lastpermissionIds:o(p).join(",")};if(c.value===!1?yield q(n):console.log("\u8BF7\u7B49\u5F85\u4E0A\u6B21\u6267\u884C\u5B8C\u6BD5!"),e)R();else{const f=yield A({roleId:o(s)});p.value=f}})}function q(e){return w(this,null,function*(){c.value=!0,yield se(e),setTimeout(()=>{c.value=!1},500)})}function L({key:e}){e==="checkAll"?i.value=_.value:e==="cancelCheck"?i.value=[]:e==="openAll"?g.value=_.value:e==="closeAll"?g.value=[]:e==="relation"?k.value=!1:k.value=!0}return(e,n)=>{const f=D("Icon"),y=D("a-menu-item"),z=D("a-menu"),M=D("a-dropdown"),I=D("a-button");return x(),F(o(G),Z(e.$attrs,{onRegister:o(P),width:"650px",destroyOnClose:"",showFooter:""}),{title:t(()=>[l(" \u89D2\u8272\u6743\u9650\u914D\u7F6E "),a(M,null,{overlay:t(()=>[a(z,{onClick:L},{default:t(()=>[a(y,{key:"checkAll"},{default:t(()=>[l("\u9009\u62E9\u5168\u90E8")]),_:1}),a(y,{key:"cancelCheck"},{default:t(()=>[l("\u53D6\u6D88\u9009\u62E9")]),_:1}),ue,a(y,{key:"openAll"},{default:t(()=>[l("\u5C55\u5F00\u5168\u90E8")]),_:1}),a(y,{key:"closeAll"},{default:t(()=>[l("\u6298\u53E0\u5168\u90E8")]),_:1}),ne,a(y,{key:"relation"},{default:t(()=>[l("\u5C42\u7EA7\u5173\u8054")]),_:1}),a(y,{key:"standAlone"},{default:t(()=>[l("\u5C42\u7EA7\u72EC\u7ACB")]),_:1})]),_:1})]),default:t(()=>[a(f,{icon:"ant-design:more-outlined",class:"more-icon"})]),_:1})]),footer:t(()=>[a(o(U),{title:"\u786E\u5B9A\u653E\u5F03\u7F16\u8F91\uFF1F",onConfirm:o(R),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:t(()=>[l("\u53D6\u6D88")]),_:1},8,["onConfirm"]),a(I,{onClick:n[0]||(n[0]=C=>B(!1)),type:"primary",loading:c.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:t(()=>[l("\u4EC5\u4FDD\u5B58")]),_:1},8,["loading"]),a(I,{onClick:n[1]||(n[1]=C=>B(!0)),type:"primary",loading:c.value},{default:t(()=>[l("\u4FDD\u5B58\u5E76\u5173\u95ED")]),_:1},8,["loading"])]),default:t(()=>[a(o(H),{ref_key:"treeRef",ref:u,checkable:"",treeData:d.value,checkedKeys:i.value,expandedKeys:g.value,selectedKeys:v.value,checkStrictly:k.value,clickRowToExpand:!1,title:"\u6240\u62E5\u6709\u7684\u7684\u6743\u9650",onCheck:N,onSelect:$},{title:t(({slotTitle:C,ruleFlag:O})=>[l(X(C)+" ",1),O?(x(),F(f,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):Y("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys","checkStrictly"]),a(ae,{onRegister:o(T)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});const De=oe(re,[["__scopeId","data-v-537e681b"]]);export{De as default};
