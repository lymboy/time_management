var J=Object.defineProperty,W=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var D=(a,n,i)=>n in a?J(a,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[n]=i,F=(a,n)=>{for(var i in n||(n={}))Z.call(n,i)&&D(a,i,n[i]);if(v)for(var i of v(n))ee.call(n,i)&&D(a,i,n[i]);return a},I=(a,n)=>W(a,Y(n));var p=(a,n,i)=>new Promise((_,w)=>{var x=c=>{try{C(i.next(c))}catch(f){w(f)}},B=c=>{try{C(i.throw(c))}catch(f){w(f)}},C=c=>c.done?_(c.value):Promise.resolve(c.value).then(x,B);C((i=i.apply(a,n)).next())});import te from"./BasicTable.7f769694.js";import{T as ne}from"./componentMap.6f8f51f6.js";import"./BasicTable.vue_vue_type_style_index_0_lang.734e51fc.js";import"./TableImg.vue_vue_type_style_index_0_lang.c653d5f6.js";import{l as oe,c as ie,s as le,g as ae,a as re,_ as se,b as ue,d as ce,e as T,f as pe}from"./CategoryModal.vue_vue_type_script_setup_true_lang.08db8d8f.js";import"./index.1c9272fa.js";import{j as L,C as de,bI as me,r as g,s as A,t as fe,v as r,w as u,y,K as l,Q as he,R as ge}from"./index.d13d32e3.js";import{useListPage as _e}from"./useListPage.6b1e9ff2.js";import"./BasicForm.e6ef05c4.js";import"./BasicForm.vue_vue_type_style_index_0_lang.46537c39.js";import"./uniqBy.0dfdca3d.js";import"./BasicModal.d291574e.js";import"./useWindowSizeFn.67dc54bf.js";import"./useFormItem.7e3b9788.js";import"./functional.fdb540f5.js";import"./download.1bc5d3ce.js";import"./base64Conver.030fa32c.js";import"./index.12d9094a.js";import"./index.d11dcab2.js";import"./useCountdown.ea4711fe.js";import"./JAddInput.ec01e271.js";import"./areaDataUtil.b0d6c4f6.js";import"./api.ae3b9cbd.js";import"./props.b623f34d.js";import"./index.61b0c164.js";import"./bem.0a70e06a.js";import"./props.1766c95e.js";import"./useContextMenu.17d08add.js";import"./index.89ad7068.js";import"./onMountedOrActivated.a5139741.js";import"./index.9bf7bffc.js";import"./htmlmixed.470d5886.js";import"./vue.aa2fc71b.js";/* empty css             */import"./depart.api.0bd5897e.js";import"./JUpload.vue_vue_type_style_index_0_lang.e5aaf763.js";import"./index.5b75652b.js";import"./index.e9229284.js";import"./useForm.1a92e1aa.js";import"./index.9013d2b9.js";import"./useContentHeight.729fdab1.js";import"./useContentViewHeight.c21fb651.js";import"./usePageContext.a7636151.js";import"./RedoOutlined.a7479f77.js";import"./useTable.c77f7905.js";const Ce=L({name:"system-category"}),dt=L(I(F({},Ce),{setup(a){const n=de([]),[i,{openModal:_}]=me(),{prefixCls:w,onExportXls:x,onImportXls:B,tableContext:C}=_e({designScope:"category-template",tableProps:{title:"\u5206\u7C7B\u5B57\u5178",api:oe,columns:ie,actionColumn:{width:180},formConfig:{schemas:le}},exportConfig:{name:"\u5206\u7C7B\u5B57\u5178\u5217\u8868",url:ae},importConfig:{url:re}}),[c,{reload:f,collapseAll:ye,updateTableDataRecord:E,findTableDataRecord:M,getDataSource:K},{rowSelection:U,selectedRowKeys:R}]=C;function j(){_(!0,{isUpdate:!1})}function N(e){return p(this,null,function*(){_(!0,{record:e,isUpdate:!0})})}function V(e){return p(this,null,function*(){yield pe({id:e.id},S)})}function P(){return p(this,null,function*(){const e=R.value.filter(t=>!t.includes("loading"));yield ue({ids:e},S)})}function S(){(R.value=[])&&f()}function X(e){_(!0,{record:e,isUpdate:!1})}function H(k){return p(this,arguments,function*({isUpdate:e,values:t,expandedArr:o}){if(e)E(t.id,t);else if(!t.pid)f();else{n.value=[];for(let d of l(o))yield q(d)}})}function O(e){b(e.items)&&Q()}function Q(){return p(this,null,function*(){if(l(n).length>0){const e=yield ce({parentIds:l(n).join(",")});if(e.success&&e.result.records.length>0){let t=e.result.records;const o=new Map;for(let m of t){let s=m.pid;if(l(n).includes(s)){let h=o.get(s);h==null&&(h=[]),h.push(m),o.set(s,h)}}let k=o,d=m=>{m&&m.forEach(s=>{l(n).includes(s.id)&&(s.children=b(k.get(s.id)),d(s.children))})};d(K())}}})}function b(e){if(e&&e.length>0)return e.map(t=>{if(t.hasChild=="1"){let o={id:t.id+"_loadChild",name:"loading...",isLoading:!0};t.children=[o]}return t})}function $(e,t){return p(this,null,function*(){if(e){if(n.value.push(t.id),t.children.length>0&&!!t.children[0].isLoading){let o=yield T({pid:t.id});o&&o.length>0?t.children=b(o):(t.children=null,t.hasChild="0")}}else{let o=n.value.indexOf(t.id);o>=0&&n.value.splice(o,1)}})}function q(e){return p(this,null,function*(){let t=M(e);n.value.push(e);let o=yield T({pid:e});o&&o.length>0?t.children=b(o):(t.children=null,t.hasChild="0"),E(e,t)})}function z(e){return[{label:"\u7F16\u8F91",onClick:N.bind(null,e)},{label:"\u5220\u9664",popConfirm:{title:"\u786E\u5B9A\u5220\u9664\u5417?",confirm:V.bind(null,e)}},{label:"\u6DFB\u52A0\u4E0B\u7EA7",onClick:X.bind(null,{pid:e.id})}]}return(e,t)=>{const o=g("a-button"),k=g("j-upload-button"),d=g("Icon"),m=g("a-menu-item"),s=g("a-menu"),h=g("a-dropdown");return A(),fe("div",null,[r(l(te),{onRegister:l(c),rowSelection:l(U),expandedRowKeys:n.value,onExpand:$,onFetchSuccess:O},{tableTitle:u(()=>[r(o,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:j},{default:u(()=>[y(" \u65B0\u589E")]),_:1}),r(o,{type:"primary",preIcon:"ant-design:export-outlined",onClick:l(x)},{default:u(()=>[y(" \u5BFC\u51FA")]),_:1},8,["onClick"]),r(k,{type:"primary",preIcon:"ant-design:import-outlined",onClick:l(B)},{default:u(()=>[y("\u5BFC\u5165")]),_:1},8,["onClick"]),l(R).length>0?(A(),he(h,{key:0},{overlay:u(()=>[r(s,null,{default:u(()=>[r(m,{key:"1",onClick:P},{default:u(()=>[r(d,{icon:"ant-design:delete-outlined"}),y(" \u5220\u9664 ")]),_:1})]),_:1})]),default:u(()=>[r(o,null,{default:u(()=>[y("\u6279\u91CF\u64CD\u4F5C "),r(d,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):ge("",!0)]),action:u(({record:G})=>[r(l(ne),{actions:z(G)},null,8,["actions"])]),_:1},8,["onRegister","rowSelection","expandedRowKeys"]),r(se,{onRegister:l(i),onSuccess:H},null,8,["onRegister"])])}}}));export{dt as default};
