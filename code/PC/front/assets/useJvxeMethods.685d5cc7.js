var y=(d,s,l)=>new Promise((u,m)=>{var f=r=>{try{n(l.next(r))}catch(o){m(o)}},e=r=>{try{n(l.throw(r))}catch(o){m(o)}},n=r=>r.done?u(r.value):Promise.resolve(r.value).then(f,e);n((l=l.apply(d,s)).next())});import{C as T,Z as g,K as b}from"./index.d13d32e3.js";import{validateFormModelAndTables as F,VALIDATE_FAILED as w}from"./vxeUtils.4caa16eb.js";function P(d,s,l,u,m,f){const e=T();function n(t,a,c,D){c.loading=!0,g.get({url:t,params:a},{isTransformResponse:!1}).then(h=>{let{result:v}=h;h.success&&v&&(Array.isArray(v)?c.dataSource=v:Array.isArray(v.records)&&(c.dataSource=v.records)),typeof D=="function"&&D(h)}).finally(()=>{c.loading=!1})}function r(t){var a,c;(c=(a=l[t])==null?void 0:a.value)==null||c.resetScrollTop(0)}function o(){let t=Object.values(l);return Promise.all(t)}function A(){o().then(t=>{let a=e.value.getFieldsValue();return F(e.value.validate,a,t,e.value.getProps,!1)}).then(t=>f&&typeof f=="function"?f(t):i(t)).then(t=>{if(typeof s!="function")throw p("classifyIntoFormData");let a=s(t);return d(a)}).catch(t=>{t.error===w?t.paneKey?u.value=t.paneKey:u.value=t.index==null?b(u):m.value[t.index]:console.error(t)})}function i(t){return new Promise(a=>{a(t)})}function p(t){return`${t} \u672A\u5B9A\u4E49\u6216\u4E0D\u662F\u4E00\u4E2A\u51FD\u6570`}return[r,A,n,e]}function x(d,s){function l(){return y(this,null,function*(){let e={},n=Object.keys(s),r="";for(let o=0;o<n.length;o++){r=n[o];let A=s[r].value;if(A.isForm){let i=yield f(A,r);i&&(e[r+"List"]=[i])}else{let i=yield m(A,r);i&&i.length>0&&(e[r+"List"]=i)}}return e})}function u(e){return e&&Object.keys(e).map(n=>{e[n]instanceof Array&&(e[n]=e[n].join(","))}),e}function m(e,n){return y(this,null,function*(){return(yield e.validateTable())?(d.value=n,e.resetScrollTop(0),Promise.reject(1)):e.getTableData()})}function f(e,n){return y(this,null,function*(){try{let r=yield e.getFormData();return u(r),r}catch(r){return d.value=n,Promise.reject(r)}})}return{getSubFormAndTableData:l,transformData:u}}export{P as useJvxeMethod,x as useValidateAntFormAndTable};
