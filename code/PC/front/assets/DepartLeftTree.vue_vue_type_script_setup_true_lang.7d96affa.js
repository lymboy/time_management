var p=(R,x,r)=>new Promise((A,g)=>{var B=o=>{try{l(r.next(o))}catch(i){g(i)}},d=o=>{try{l(r.throw(o))}catch(i){g(i)}},l=o=>o.done?A(o.value):Promise.resolve(o.value).then(B,d);l((r=r.apply(R,x)).next())});import"./index.1c9272fa.js";import{j as ve,bj as me,C as c,bI as he,r as s,s as f,Q as E,w as a,aW as _,v as n,y,R as q,t as K,ax as P,z as W,K as I,ea as ge,G as z,u as ke,au as Ce}from"./index.d13d32e3.js";import{q as G,A as Q,d as De}from"./depart.api.0bd5897e.js";import{s as Ee}from"./depart.user.api.fdf3773d.js";import{_ as xe}from"./DepartFormModal.vue_vue_type_script_setup_true_lang.490fbae0.js";const Ae={class:"j-table-operator",style:{width:"100%"}},Be=_("span",null,"\u5220\u9664",-1),Fe=_("span",null,"\u6279\u91CF\u64CD\u4F5C ",-1),we={key:1},Te=_("span",{style:{color:"red"}},"\u5220\u9664",-1),Ue=ve({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(R,{expose:x,emit:r}){me("prefixCls");const{createMessage:A}=ke(),{handleImportXls:g,handleExportXls:B}=Ce(),d=c(!1),l=c([]),o=c([]),i=c([]),h=c([]),F=c(!1),H=c(!0),w=c(null),T=c(null),J=c(""),[O,{openModal:S}]=he();function v(){return p(this,null,function*(){try{d.value=!0,l.value=[];const e=yield G();if(Array.isArray(e)&&(l.value=e),i.value.length===0)M();else if(h.value.length===0){let t=l.value[0];t&&k(t.id,t)}else r("select",w.value);r("rootTreeData",l.value)}finally{d.value=!1}})}v();function Y(e){return p(this,null,function*(){try{const t=yield G({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,i.value.length>0){let u=[];for(let C of i.value)t.findIndex(D=>D.id===C)!==-1&&u.push(C);u.length>0&&(i.value=[...i.value])}l.value=[...l.value],r("rootTreeData",l.value)}catch(t){console.error(t)}return Promise.resolve()})}function M(){let e=l.value[0];e?(e.isLeaf||(i.value=[e.key]),k(e.id,e),Z()):r("select",null)}function Z(){return p(this,null,function*(){yield z(),F.value=!0,yield z(),F.value=!1})}function k(e,t){h.value=[e],t&&(w.value=t,r("select",t))}function ee(){S(!0,{isUpdate:!1,isChild:!1})}function U(e=w.value){if(e==null){A.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};S(!0,{isUpdate:!1,isChild:!0,record:t})}function te(e){return p(this,null,function*(){if(e)try{d.value=!0,l.value=[];let t=yield Ee({keyWord:e});Array.isArray(t)&&(l.value=t),M()}finally{d.value=!1}else v();J.value=e})}function ae(e){Array.isArray(e)?o.value=e:o.value=e.checked}function ne(e,t){console.log("select: ",e,t),e.length>0&&h.value[0]!==e[0]?k(e[0],t.selectedNodes[0]):k(h.value[0])}function $(e,t=!0){return p(this,null,function*(){const u=I(e);if(u.length>0)try{d.value=!0,yield De({ids:u.join(",")},t),yield v()}finally{d.value=!1}})}function le(e){return p(this,null,function*(){e&&(j(!1),$([e.id],!1))})}function oe(){return p(this,null,function*(){try{yield $(o),o.value=[]}finally{}})}function j(e){e||(T.value=null)}function ue(e){g(e,Q.importExcelUrl,()=>{v()})}function se(){B("\u90E8\u95E8\u4FE1\u606F",Q.exportXlsUrl)}return x({loadRootTreeData:v}),(e,t)=>{const u=s("a-button"),C=s("a-upload"),D=s("icon"),b=s("a-menu-item"),L=s("a-menu"),V=s("a-dropdown"),ie=s("a-divider"),re=s("a-alert"),ce=s("a-input-search"),de=s("a-tree"),pe=s("a-empty"),fe=s("a-spin"),ye=s("a-card");return f(),E(ye,{bordered:!1,style:{height:"100%"}},{default:a(()=>[_("div",Ae,[n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ee},{default:a(()=>[y("\u65B0\u589E")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=m=>U())},{default:a(()=>[y("\u6DFB\u52A0\u4E0B\u7EA7")]),_:1}),n(C,{name:"file",showUploadList:!1,customRequest:ue},{default:a(()=>[n(u,{type:"primary",preIcon:"ant-design:import-outlined"},{default:a(()=>[y("\u5BFC\u5165")]),_:1})]),_:1}),n(u,{type:"primary",preIcon:"ant-design:export-outlined",onClick:se},{default:a(()=>[y("\u5BFC\u51FA")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("\u540C\u6B65\u4F01\u5FAE?")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("\u540C\u6B65\u9489\u9489?")]),_:1}),o.value.length>0?(f(),E(V,{key:0},{overlay:a(()=>[n(L,null,{default:a(()=>[n(b,{key:"1",onClick:oe},{default:a(()=>[n(D,{icon:"ant-design:delete-outlined"}),Be]),_:1})]),_:1})]),default:a(()=>[n(u,null,{default:a(()=>[Fe,n(D,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):q("",!0)]),n(re,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:a(()=>[o.value.length>0?(f(),K(P,{key:0},[_("span",null,"\u5DF2\u9009\u4E2D "+W(o.value.length)+" \u6761\u8BB0\u5F55",1),n(ie,{type:"vertical"}),_("a",{onClick:t[1]||(t[1]=m=>o.value=[])},"\u6E05\u7A7A")],64)):(f(),K("span",we,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),n(fe,{spinning:d.value},{default:a(()=>[n(ce,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:te}),l.value.length>0?(f(),K(P,{key:0},[F.value?q("",!0):(f(),E(de,{key:0,checkable:"",clickRowToExpand:!1,treeData:l.value,selectedKeys:h.value,checkStrictly:H.value,"load-data":Y,checkedKeys:o.value,expandedKeys:i.value,"onUpdate:expandedKeys":t[3]||(t[3]=m=>i.value=m),onCheck:ae,onSelect:ne},{title:a(({key:m,title:_e,dataRef:X})=>[n(V,{trigger:["contextmenu"]},{overlay:a(()=>[n(L,{onClick:t[2]||(t[2]=()=>{})},{default:a(()=>[n(b,{key:"1",onClick:N=>U(X)},{default:a(()=>[y("\u6DFB\u52A0\u5B50\u7EA7")]),_:2},1032,["onClick"]),n(b,{key:"2",onClick:N=>T.value=m},{default:a(()=>[Te]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(I(ge),{visible:T.value===m,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:N=>le(X),onVisibleChange:j},{default:a(()=>[_("span",null,W(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(f(),E(pe,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["spinning"]),n(xe,{rootTreeData:l.value,onRegister:I(O),onSuccess:v},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{Ue as _};
